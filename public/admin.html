<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Admin Panel - WaveChem</title>
  <link rel="stylesheet" href="style.css">
</head>
<body>
  <div class="container">
    <!-- Admin Login Section -->
    <h2>üîí Admin Login</h2>
    <div id="loginSection">
      <input type="password" id="adminPassword" placeholder="Enter admin password">
      <button id="loginBtn">Login</button>
      <p id="loginMessage"></p>
    </div>

    <!-- Upload Section (hidden initially) -->
    <div id="uploadSection" style="display:none;">
      <h2>üì§ Upload Study Material</h2>
      <form id="uploadForm" enctype="multipart/form-data">
        <input type="text" name="title" placeholder="Material Title" required>

        <select name="classType" required>
          <option value="">-- Select Class --</option>
          <option value="class11">Class 11</option>
          <option value="class12">Class 12</option>
          <option value="jee">JEE</option>
          <option value="neet">NEET</option>
        </select>

        <textarea name="description" placeholder="Short Description"></textarea>
        <input type="file" name="file" required>
        <button type="submit">Upload</button>
      </form>
      <p id="message"></p>

      <h2>üìÑ Uploaded Materials</h2>
      <div id="materialsList"></div>
    </div>
  </div>

  <script>
    // ----------------- Admin Login -----------------
    const correctPassword = "wavechem"; // Change this to your desired password
    const loginBtn = document.getElementById('loginBtn');
    const adminPassword = document.getElementById('adminPassword');
    const loginMessage = document.getElementById('loginMessage');
    const loginSection = document.getElementById('loginSection');
    const uploadSection = document.getElementById('uploadSection');

    loginBtn.addEventListener('click', () => {
      if(adminPassword.value === correctPassword){
        loginSection.style.display = "none";
        uploadSection.style.display = "block";
      } else {
        loginMessage.textContent = "‚ùå Wrong password!";
        loginMessage.style.color = "red";
      }
    });

    // ----------------- Upload Material -----------------
    const form = document.getElementById('uploadForm');
    const message = document.getElementById('message');
    const materialsDiv = document.getElementById('materialsList');

    form.addEventListener('submit', async (e) => {
      e.preventDefault();
      const formData = new FormData(form);
      try {
        const res = await fetch('/api/upload', { method: 'POST', body: formData });
        const data = await res.json();
        if (data.success) {
          message.textContent = "‚úÖ Material uploaded successfully!";
          message.className = "success";
          form.reset();
          loadMaterials();
        } else {
          message.textContent = "‚ùå Upload failed!";
          message.className = "error";
        }
      } catch(err) {
        message.textContent = "‚ö†Ô∏è Server error!";
        message.className = "error";
        console.error(err);
      }
    });

    // ----------------- Load Materials -----------------
    async function loadMaterials() {
      try {
        const res = await fetch('/api/materials');
        const materials = await res.json();
        materialsDiv.innerHTML = "";

        if(materials.length === 0){
          materialsDiv.innerHTML = "<p>No materials uploaded yet.</p>";
          return;
        }

        materials.forEach(m => {
          const div = document.createElement('div');
          div.className = "material-card";
          div.innerHTML = `
            <h3>${m.title}</h3>
            <p><strong>Class:</strong> ${m.classType}</p>
            <p>${m.description || ""}</p>
            <a class="download-btn" href="/uploads/${m.filename}" download>‚¨áÔ∏è Download</a>
            <button class="delete-btn" data-id="${m.id}" style="margin-left:10px;background:red;color:white;">üóë Delete</button>
          `;
          materialsDiv.appendChild(div);
        });

        // ----------------- Delete Function -----------------
        document.querySelectorAll('.delete-btn').forEach(btn => {
          btn.addEventListener('click', async () => {
            const id = Number(btn.getAttribute('data-id'));
            if(confirm("Are you sure you want to delete this material?")){
              try {
                const res = await fetch('/api/delete/' + id, { method: 'DELETE' });
                const data = await res.json();
                console.log("Delete response:", data);
                if(data.success){
                  alert("‚úÖ Deleted successfully!");
                  loadMaterials();
                } else {
                  alert("‚ùå Delete failed!");
                }
              } catch(err){
                alert("‚ö†Ô∏è Server error!");
                console.error(err);
              }
            }
          });
        });

      } catch(err){
        materialsDiv.innerHTML = "<p>‚ö†Ô∏è Failed to load materials.</p>";
        console.error(err);
      }
    }

    loadMaterials();
  </script>
</body>
</html>
